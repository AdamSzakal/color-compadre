
// color dom elements
const colorDOM = function (el) {

    el.forEach(function (section, index) {
        // generate a "base color" ðŸ‘‡
        let currentColor = hueScale(index / el.length);
        // generate an array of colors going from white to black, via the "base color" ðŸ‘‡
        const lightnessScale = Chroma.scale(['white', currentColor, 'black']).mode(
            'lch',
        );

        // loop through all nodes for each section ðŸ‘‡
        swatches.forEach(function (swatchContainer, index) {
            console.log(swatchContainer);

            let childNodeColor = Chroma(
                lightnessScale(index / section.childNodes.length)
            ).hex();

            let someColor = namedColors.colorNameList.find(
                color => color.hex === childNodeColor
            );

            // Get color names from API
            let request = new XMLHttpRequest();
            request.open('GET', 'https://api.color.pizza/v1/' + childNodeColor.replace(/[^0-9]/, ''), true);
            request.onload = function () {
                let data = JSON.parse(this.response);
                if (request.status >= 200 && request.status < 400) {
                    // div.innerText = data.colors[0].name;
                    swatchContainer.style.backgroundColor = childNodeColor;
                } else {
                    console.log('error');
                }
            };
            request.send();
        });
    });
};


document.addEventListener("DOMContentLoaded", function () {
    colorInit();
    colorDOM(sections);

    // the function to be run on click
    const selectColor = function (e) {
        console.log("color selected");
        e.target.classList.toggle("selected");
        addToSelectedColors(e);
    }

    // highlight selected color and add to array
    const addToSelectedColors = function (e) {
        console.log("added");
        selectedColors.push(e.target);
        // get the markup for each of the DOM elements in the selectedColors array
        document.querySelector("#selected-colors").innerHTML = selectedColors.map(target => target.outerHTML).join(" ");
    }

    // Clear selection, both visually and data-wise
    const clear = function () {
        console.log("cleared");
        selectedColors.map(target => target.classList.remove("selected"));
        document.querySelector("#selected-colors").innerHTML = "No selected colors";
        selectedColors = [];
    }

    // clear selected colors, initate new colors and color dom again
    const reload = function () {
        clear();
        colorInit();
        colorDOM(divs);
    }

    //add event listener to all divs 
    divs.forEach(function (div) {
        div.addEventListener('click', selectColor);
    });

    // add event listener to buttons
    const copyButton = document.querySelector("#copy"),
        reloadButton = document.querySelector("#reload"),
        clearButton = document.querySelector("#clear");

    copyButton.addEventListener('click', copy);
    reloadButton.addEventListener('click', reload);
    clearButton.addEventListener('click', clear);

});